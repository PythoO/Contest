{% extends "admin/layout.html" %}

{% block title %}Roles{%endblock%}

{% block body %}
<h2><span class="glyphicon glyphicon-bookmark"></span> Roles</h2>
<hr>
<div ng-app="" ng-controller="customersController">
    <table class="table table-striped">
        <thead>
        <tr>
            <th>#</th>
            <th>Title</th>
            <th>Modify</th>
            <th>Delete</th>
        </tr>
        </thead>
        <tr ng-repeat="x in roles">
            {% raw %}
            <td>{{ x.id }}</td>
            <td>{{ x.name }}</td>
            {% endraw %}
            <td>
                <button class="btn btn-primary" ng-click="editRole($index)">
                    <span class="glyphicon glyphicon-pencil"></span>  Edit
                </button>
            </td>
            <td>
                <button class="btn btn-warning" ng-click="deleteRole(x.id, $index)">
                    <span class="glyphicon glyphicon-pencil"></span>  Delete
                </button>
            </td>
        </tr>
    </table>
    <hr>
    <form class="form-horizontal">
        <div class="form-group">
            <label class="col-sm-2 control-label">Role Name:</label>

            <div class="col-sm-10">
                <input type="hidden" ng-model="id">
                <input type="text" ng-model="name" placeholder="Role Name">
            </div>
        </div>
    </form>
    <hr>
    <button class="btn btn-success" ng-click="createRole()">
        <span class="glyphicon glyphicon-save"></span> Create Role
    </button>
    <button class="btn btn-success" ng-click="updateRole()">
        <span class="glyphicon glyphicon-ok-circle"></span> Update Role
    </button>
    <button class="btn btn-success" ng-click="reset()">
        <span class="glyphicon glyphicon-refresh"></span> RESET
    </button>
</div>

<script>
function customersController($scope,$http) {
    $scope.id = '';
    $scope.name = '';
    $scope.edit = true;
    $scope.error = false;
    $scope.incomplete = false;
    $http.get("/api/role")
    .success(function(data) {
        $scope.roles = data.objects;
    });

    $scope.editRole = function(id) {
        if (id == 'new') {
            $scope.name = '';
            $scope.id='';
        } else {
            $scope.name = $scope.roles[id].name;
            $scope.id = $scope.roles[id].id;
        }
    };

    $scope.createRole = function() {
        var data = { name: $scope.name };
        $http.post("/api/role", data)
        .success(function(data, status, headers) {
            $http.get(headers("location")).success(function(data){
                $scope.roles.push(data)
            });
        });
    };

    $scope.updateRole = function() {
        var data = { name: $scope.name };
        $http.put("/api/role/" + $scope.id, data)
            .success(function(data, status, headers) {
                    $http.get("/api/role")
                        .success(function(data) {
                        $scope.roles = data.objects;
                    });
            });
    };

    $scope.deleteRole = function(id, index) {
        var r = confirm('Are you sure !!');
        if (r == true) {
            $http.delete("/api/role/"+ id)
            .success(function(data, status, headers) {
                $scope.roles.splice(index, 1)
            });
        }
    };

    $scope.reset = function() {
        $scope.name = "";
    };
    $scope.reset();
}

</script>
{% endblock %}

{% block javascript %}
{% endblock %}